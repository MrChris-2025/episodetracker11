<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basement Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'netflix-red': '#E50914',
                        'netflix-dark': '#0a0a0a',
                        'netflix-medium': '#141414',
                        'netflix-light': '#232323',
                    }
                }
            }
        }
    </script>
    <script type="module">
        import { createIcons, MonitorPlay, Film, Tv, ChevronLeft, ChevronRight, Search, Loader } from 'https://unpkg.com/lucide@latest';
        createIcons({ icons: { MonitorPlay, Film, Tv, ChevronLeft, ChevronRight, Search, Loader } });
        window.MonitorPlay = MonitorPlay; window.Film = Film; window.Tv = Tv; window.Loader = Loader;
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0a0a;
            color: #e4e4e7;
            margin: 0;
            padding: 0;
        }

        #main-content-area { height: calc(100vh - 4rem); display: flex; }
        
        /* ORIGINAL SCROLL CODING PRESERVED */
        #content-list-container { overflow-y: auto; height: 100%; flex-grow: 1; }
        #content-list-container::-webkit-scrollbar { width: 6px; }
        #content-list-container::-webkit-scrollbar-thumb { background-color: #e50914; border-radius: 3px; }
        #content-list-container::-webkit-scrollbar-track { background: #1a1a1a; }

        .player-iframe {
            height: 500px;
            width: 100%;
            background: #000;
            transition: all 0.5s ease;
        }

        .theater-iframe-stretch { height: 100% !important; border-radius: 0 !important; }
        .full-immersion-right { padding: 0 !important; }

        /* OVERLAY SYSTEM */
        #stream-controls-1 {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 800px;
            z-index: 50;
            background: rgba(10, 10, 10, 0.85);
            backdrop-filter: blur(8px);
            padding: 12px 20px;
            border-radius: 12px;
            border: 1px solid rgba(229, 9, 20, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out;
        }

        #stream-controls-1.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* ORIGINAL SCROLL INDICATORS PRESERVED */
        .scroll-indicator { z-index: 30; cursor: pointer; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        #scroll-up-indicator { background: linear-gradient(to bottom, rgba(15, 15, 15, 0.9), transparent 80%); }
        #scroll-down-indicator { background: linear-gradient(to top, rgba(15, 15, 15, 0.9), transparent 80%); }
        .scroll-indicator.visible { opacity: 1; pointer-events: auto; }

        select { background: #1c1c1c; border: 1px solid #4a0000; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 12px; outline: none; }
    </style>
</head>
<body>

    <header class="h-16 bg-netflix-dark flex items-center px-6 shadow-2xl sticky top-0 border-b border-white/10 z-50">
        <h1 class="text-2xl font-black text-netflix-red tracking-tighter">BASEMENT TIME</h1>
        <div class="flex-grow flex justify-center">
            <span id="player-status-text" class="text-xs font-bold text-gray-400 uppercase tracking-widest bg-white/5 px-4 py-1 rounded-full border border-white/10">Select Content</span>
        </div>
        <a href="https://mysite2026.netlify.app/basement.html" class="text-xs font-bold text-gray-500 hover:text-white transition">(SPORTS)</a>
    </header>

    <div id="main-content-area">
        <div id="left-panel" class="w-[30%] min-w-[320px] bg-netflix-medium p-4 flex flex-col space-y-4 border-r border-white/5 transition-all duration-500">
            <div id="controls-container" class="space-y-3">
                <div class="flex bg-black rounded-lg p-1 border border-white/10">
                    <button data-type="movie" class="content-toggle-btn flex-grow py-2 text-xs font-black uppercase rounded transition bg-netflix-red text-white">Movies</button>
                    <button data-type="tv" class="content-toggle-btn flex-grow py-2 text-xs font-black uppercase rounded transition text-gray-500 hover:text-white">TV Shows</button>
                </div>
                <div class="flex space-x-2">
                    <select id="genre-filter" class="w-1/2 uppercase font-bold">Genres</select>
                    <select id="year-filter" class="w-1/2 uppercase font-bold">Years</select>
                </div>
                <div class="relative">
                    <input type="text" id="content-search" placeholder="SEARCH..." class="w-full p-3 pl-10 rounded-xl bg-netflix-dark border border-white/5 text-sm outline-none focus:border-netflix-red transition">
                    <i data-lucide="search" class="w-4 h-4 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"></i>
                </div>
            </div>

            <div id="list-wrapper" class="relative flex-grow flex overflow-hidden">
                <div id="scroll-up-indicator" class="scroll-indicator absolute top-0 left-0 right-0 h-10 flex justify-end items-end pr-4 pt-2">
                    <button class="w-8 h-8 bg-gray-700/90 rounded-full flex items-center justify-center text-xl" onclick="document.getElementById('content-list-container').scrollBy({ top: -300, behavior: 'smooth' })">ðŸ”º</button>
                </div>
                <div id="content-list-container" class="flex-grow space-y-4 pr-4 h-full">
                    <div id="content-list" class="space-y-3"></div>
                </div>
                <div id="scroll-down-indicator" class="scroll-indicator absolute bottom-0 left-0 right-0 h-10 flex justify-end items-start pr-4 pb-2">
                    <button class="w-8 h-8 bg-gray-700/90 rounded-full flex items-center justify-center text-xl" onclick="document.getElementById('content-list-container').scrollBy({ top: 300, behavior: 'smooth' })">ðŸ”»</button>
                </div>
            </div>
        </div>

        <div id="right-panel" class="flex-grow bg-netflix-dark relative transition-all duration-500 flex flex-col items-center justify-center p-6">
            <div id="player-area-1" class="relative w-full max-w-5xl rounded-2xl overflow-hidden shadow-2xl border border-white/5">
                <div id="player-message-overlay" class="absolute inset-0 bg-black/90 z-10 flex items-center justify-center text-center">
                    <p class="text-gray-500 font-bold uppercase tracking-widest">Select a title to play</p>
                </div>

                <iframe id="stream-player-1" class="player-iframe" src="" frameborder="0" allowfullscreen></iframe>

                <div id="stream-controls-1">
                    <div class="flex items-center space-x-4">
                        <select id="source-selector-1"></select>
                        <div id="tv-controls" class="hidden items-center space-x-2">
                            <button id="prev-episode-btn" class="bg-netflix-red px-2 py-1 rounded text-[10px] font-bold">PREV</button>
                            <select id="season-selector"></select>
                            <select id="episode-selector"></select>
                            <button id="next-episode-btn" class="bg-netflix-red px-2 py-1 rounded text-[10px] font-bold">NEXT</button>
                        </div>
                    </div>
                    <button id="toggle-theater-mode-btn" class="bg-netflix-red px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest shadow-lg" onclick="toggleTheaterMode()">Theater Mode</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const TMDB_API_KEY = '1070730380f5fee0d87cf0382670b255';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        const FALLBACK_POSTER_URL = 'https://placehold.co/100x150/1c1c1c/999999?text=No+Poster';
        
        const availableSources = [
            { id: 'wplayme', name: 'Wplay.me', urls: { movie: 'https://embed.wplay.me/embed/movie/{id}', tv: 'https://embed.wplay.me/embed/tv/{id}/{season}/{episode}' } },
            { id: 'primewire', name: 'Primewire', urls: { movie: 'https://www.primewire.tf/embed/movie?tmdb={id}', tv: 'https://www.primewire.tf/embed/tv?tmdb={id}&season={season}&episode={episode}&server=fileLions' } },
            { id: 'vidpop', name: 'Vidpop', urls: { movie: 'https://www.vidpop.xyz/embed/?id={id}', tv: 'https://www.vidpop.xyz/embed/?id={id}&season={season}&episode={episode}' } },
            { id: 'vidsrcpk', name: 'VidSrcPk', urls: { movie: 'https://vidsrc.win/movie/?id={id}', tv: 'https://vidsrc.win/tv.html?id={id}&season={season}&episode={episode}' } },
            { id: 'rive', name: 'RiveStream', urls: { movie: 'https://rivestream.org/embed?type=movie&id={id}', tv: 'https://rivestream.org/embed?type=tv&id={id}&season={season}&episode={episode}' } },
            { id: 'vidnest', name: 'VidNest', urls: { movie: 'https://vidnest.fun/movie/{id}', tv: 'https://vidnest.fun/tv/{id}/{season}/{episode}' } },
            { id: 'bludclart', name: 'Bludclart', urls: { movie: 'https://watch.bludclart.com/movie/{id}', tv: 'https://www.vidking.net/embed/tv/{id}/{season}/{episode}' } },
            { id: 'hexa', name: 'Hexa', urls: { movie: 'https://hexa.watch/watch/movie/{id}', tv: 'https://hexa.watch/watch/tv/{id}/{season}/{episode}' } },
            { id: 'vidzee', name: 'VidZee', urls: { movie: 'https://player.vidzee.wtf/embed/movie/{id}', tv: 'https://player.vidzee.wtf/embed/tv/{id}/{season}/{episode}' } },
            { id: 'vidify', name: 'Vidify', urls: { movie: 'https://vidify.top/embed/movie/{id}', tv: 'https://vidify.top/embed/tv/{id}/{season}/{episode}' } },
            { id: 'spenflix', name: 'SpenFlix', urls: { movie: 'https://spencerdevs.xyz/movie/{id}', tv: 'https://spencerdevs.xyz/tv/{id}/{season}/{episode}' } },
            { id: 'pstream', name: 'P-Stream', urls: { movie: 'https://iframe.pstream.org/embed/tmdb-movie-{id}', tv: 'https://iframe.pstream.org/embed/tmdb-tv-{id}/{season}/{episode}' } }
        ];

        let selectedContent = null;
        let tvDetails = null;
        let isTheaterMode = false; 
        let currentContentTypeFilter = 'movie'; 
        let cachedGenres = { movie: null, tv: null };
        let overlayTimer;

        const contentListContainerEl = document.getElementById('content-list-container');
        const contentSearchEl = document.getElementById('content-search');
        const contentListEl = document.getElementById('content-list');
        const rightPanelEl = document.getElementById('right-panel');
        const playerArea1El = document.getElementById('player-area-1');
        const player1Iframe = document.getElementById('stream-player-1');
        const playerMessageOverlayEl = document.getElementById('player-message-overlay');
        const playerStatusTextEl = document.getElementById('player-status-text'); 
        const streamControls1El = document.getElementById('stream-controls-1');
        const sourceSelector1El = document.getElementById('source-selector-1');
        const theaterBtn = document.getElementById('toggle-theater-mode-btn');
        const genreFilterEl = document.getElementById('genre-filter'); 
        const yearFilterEl = document.getElementById('year-filter');   
        const tvControlsEl = document.getElementById('tv-controls');
        const seasonSelectorEl = document.getElementById('season-selector');
        const episodeSelectorEl = document.getElementById('episode-selector');
        const nextEpisodeBtn = document.getElementById('next-episode-btn');
        const prevEpisodeBtn = document.getElementById('prev-episode-btn');
        const leftPanelEl = document.getElementById('left-panel');
        const scrollUpIndicatorEl = document.getElementById('scroll-up-indicator');
        const scrollDownIndicatorEl = document.getElementById('scroll-down-indicator');

        // OVERLAY LOGIC
        function showOverlay() {
            if (!selectedContent) return;
            streamControls1El.classList.add('visible');
            clearTimeout(overlayTimer);
            overlayTimer = setTimeout(() => {
                streamControls1El.classList.remove('visible');
            }, 5000);
        }

        playerArea1El.addEventListener('mousemove', showOverlay);
        playerArea1El.addEventListener('click', showOverlay);

        async function safeFetch(url) {
            try {
                const response = await fetch(url);
                return await response.json();
            } catch (error) { return null; }
        }

        function getPlayerUrl(sourceId, tmdbId, contentType, season = 1, episode = 1) {
            const source = availableSources.find(s => s.id === sourceId);
            if (!source) return '';
            let template = contentType === 'movie' ? source.urls.movie : source.urls.tv;
            return template.replace('{id}', tmdbId).replace('{season}', season).replace('{episode}', episode);
        }
        
        function loadStreamIntoPlayer(streamUrl) {
            if (streamUrl) {
                playerMessageOverlayEl.style.display = 'none';
                player1Iframe.src = streamUrl;
                showOverlay();
            } else {
                playerMessageOverlayEl.style.display = 'flex';
                player1Iframe.src = '';
            }
        }

        async function updatePlayerFromSelection() {
            if (!selectedContent) return;
            const sourceId = sourceSelector1El.value;
            const contentType = selectedContent.media_type || currentContentTypeFilter;
            const tmdbId = selectedContent.id;
            let finalUrl = '';

            if (contentType === 'tv') {
                const s = seasonSelectorEl.value || 1;
                const e = episodeSelectorEl.value || 1;
                finalUrl = getPlayerUrl(sourceId, tmdbId, contentType, s, e);
                playerStatusTextEl.textContent = `${selectedContent.name || selectedContent.title} - S${s} E${e}`;
            } else {
                finalUrl = getPlayerUrl(sourceId, tmdbId, contentType);
                playerStatusTextEl.textContent = selectedContent.title || selectedContent.name;
            }
            loadStreamIntoPlayer(finalUrl);
        }

        function updateSeasonSelector() {
            seasonSelectorEl.innerHTML = '';
            if (tvDetails?.seasons) {
                tvDetails.seasons.filter(s => s.season_number > 0).forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s.season_number; opt.textContent = `S${s.season_number}`;
                    seasonSelectorEl.appendChild(opt);
                });
            }
            seasonSelectorEl.onchange = updateEpisodeSelector;
            updateEpisodeSelector();
        }

        function updateEpisodeSelector() {
            episodeSelectorEl.innerHTML = '';
            const sNum = parseInt(seasonSelectorEl.value);
            const sData = tvDetails?.seasons?.find(s => s.season_number === sNum);
            if (sData) {
                for (let i = 1; i <= sData.episode_count; i++) {
                    const opt = document.createElement('option');
                    opt.value = i; opt.textContent = `E${i}`;
                    episodeSelectorEl.appendChild(opt);
                }
            }
            updatePlayerFromSelection();
        }

        async function loadContentDetails(content) {
            selectedContent = content;
            if ((content.media_type || currentContentTypeFilter) === 'tv') {
                tvDetails = await safeFetch(`${TMDB_BASE_URL}/tv/${content.id}?api_key=${TMDB_API_KEY}`);
                tvControlsEl.classList.replace('hidden', 'flex');
                updateSeasonSelector();
            } else {
                tvControlsEl.classList.replace('flex', 'hidden');
                updatePlayerFromSelection();
            }
        }

        function renderContent(items) {
            contentListEl.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'bg-netflix-medium hover:bg-white/5 transition p-2 rounded cursor-pointer border border-white/5 flex space-x-3';
                const poster = item.poster_path ? IMAGE_BASE_URL + item.poster_path : FALLBACK_POSTER_URL;
                div.innerHTML = `<img src="${poster}" class="w-12 h-16 rounded object-cover"><div class="min-w-0"><p class="font-bold text-xs truncate uppercase">${item.title || item.name}</p><p class="text-[10px] text-gray-500">${(item.release_date || item.first_air_date || '').split('-')[0]}</p></div>`;
                div.onclick = () => loadContentDetails(item);
                contentListEl.appendChild(div);
            });
            updateScrollIndicators();
        }

        /* ORIGINAL SCROLL LOGIC PRESERVED */
        function updateScrollIndicators() {
            const { scrollTop, scrollHeight, clientHeight } = contentListContainerEl;
            scrollUpIndicatorEl.classList.toggle('visible', scrollTop > 10);
            scrollDownIndicatorEl.classList.toggle('visible', scrollHeight - scrollTop - clientHeight > 10);
        }

        async function fetchContent() {
            const type = currentContentTypeFilter;
            const search = contentSearchEl.value.trim();
            const genre = genreFilterEl.value;
            const year = yearFilterEl.value;
            let url = search ? `${TMDB_BASE_URL}/search/${type}?query=${encodeURIComponent(search)}&` : `${TMDB_BASE_URL}/discover/${type}?sort_by=popularity.desc&`;
            if (!search) {
                if (genre) {
                    const gId = cachedGenres[type].find(g => g.name === genre)?.id;
                    if (gId) url += `with_genres=${gId}&`;
                }
                if (year) url += `${type === 'movie' ? 'primary_release_year' : 'first_air_date_year'}=${year}&`;
            }
            const data = await safeFetch(`${url}api_key=${TMDB_API_KEY}`);
            if (data?.results) renderContent(data.results);
        }

        function toggleTheaterMode() {
            isTheaterMode = !isTheaterMode;
            if (isTheaterMode) {
                leftPanelEl.classList.add('hidden');
                rightPanelEl.classList.add('full-immersion-right');
                playerArea1El.classList.replace('max-w-5xl', 'max-w-full');
                playerArea1El.classList.add('h-screen', 'w-screen');
                player1Iframe.classList.add('theater-iframe-stretch');
                theaterBtn.textContent = 'Exit Theater';
            } else {
                leftPanelEl.classList.remove('hidden');
                rightPanelEl.classList.remove('full-immersion-right');
                playerArea1El.classList.replace('max-w-full', 'max-w-5xl');
                playerArea1El.classList.remove('h-screen', 'w-screen');
                player1Iframe.classList.remove('theater-iframe-stretch');
                theaterBtn.textContent = 'Theater Mode';
            }
        }

        window.onload = async () => {
            availableSources.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id; opt.textContent = s.name;
                sourceSelector1El.appendChild(opt);
            });
            sourceSelector1El.onchange = updatePlayerFromSelection;
            
            const mG = await safeFetch(`${TMDB_BASE_URL}/genre/movie/list?api_key=${TMDB_API_KEY}`);
            const tG = await safeFetch(`${TMDB_BASE_URL}/genre/tv/list?api_key=${TMDB_API_KEY}`);
            cachedGenres.movie = mG?.genres; cachedGenres.tv = tG?.genres;
            
            genreFilterEl.innerHTML = '<option value="">Genres</option>';
            [...new Set([...(mG?.genres || []).map(g=>g.name), ...(tG?.genres || []).map(g=>g.name)])].sort().forEach(n => {
                const opt = document.createElement('option');
                opt.value = n; opt.textContent = n;
                genreFilterEl.appendChild(opt);
            });

            yearFilterEl.innerHTML = '<option value="">Years</option>';
            for(let i=2026; i>=1990; i--) {
                const opt = document.createElement('option');
                opt.value = i; opt.textContent = i;
                yearFilterEl.appendChild(opt);
            }

            contentSearchEl.oninput = fetchContent;
            genreFilterEl.onchange = fetchContent;
            yearFilterEl.onchange = fetchContent;
            document.querySelectorAll('.content-toggle-btn').forEach(b => b.onclick = (e) => {
                currentContentTypeFilter = e.target.dataset.type;
                document.querySelectorAll('.content-toggle-btn').forEach(btn => btn.classList.replace('bg-netflix-red', 'text-gray-500'));
                e.target.classList.replace('text-gray-500', 'bg-netflix-red');
                e.target.classList.add('text-white');
                fetchContent();
            });

            nextEpisodeBtn.onclick = () => {
                episodeSelectorEl.selectedIndex++;
                updatePlayerFromSelection();
            };
            prevEpisodeBtn.onclick = () => {
                episodeSelectorEl.selectedIndex--;
                updatePlayerFromSelection();
            };

            contentListContainerEl.onscroll = updateScrollIndicators;
            fetchContent();
        };
    </script>
</body>
</html>
