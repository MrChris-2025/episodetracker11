<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basement Time | Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'netflix-red': '#E50914',
                        'netflix-dark': '#080808',
                        'netflix-medium': '#121212',
                        'netflix-light': '#1e1e1e',
                        'glass-border': 'rgba(255, 255, 255, 0.1)'
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }
                }
            }
        }
    </script>
    <script type="module">
        import { createIcons, MonitorPlay, Film, Tv, ChevronLeft, ChevronRight, Search, Loader, Star, Maximize2, Minimize2 } from 'https://unpkg.com/lucide@latest';
        window.lucideIcons = { MonitorPlay, Film, Tv, ChevronLeft, ChevronRight, Search, Loader, Star, Maximize2, Minimize2 };
        window.refreshIcons = () => createIcons({ icons: window.lucideIcons });
    </script>
    <style>
        body { background-color: #080808; color: #f4f4f5; overflow: hidden; height: 100vh; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #E50914; }

        #main-content-area { height: calc(100vh - 4rem); display: flex; }
        
        /* FIXED SCROLLING LOGIC */
        #content-list-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.2s ease;
        }
        .glass-card:hover { border-color: #E50914; background: rgba(255, 255, 255, 0.06); }
        .glass-card.active { border-color: #E50914; background: rgba(229, 9, 20, 0.05); box-shadow: 0 0 15px rgba(229, 9, 20, 0.1); }

        .theater-active #left-panel { width: 0; min-width: 0; padding: 0; border: 0; opacity: 0; pointer-events: none; }
        .theater-active #right-panel { padding: 0; }
        .theater-active #player-area-wrapper { max-width: 100%; height: 100%; border-radius: 0; }
        .theater-active iframe { height: 100% !important; border-radius: 0; }
    </style>
</head>
<body class="antialiased">

    <header class="h-16 border-b border-glass-border bg-netflix-dark flex items-center px-6 justify-between z-50 relative">
        <div class="flex items-center gap-4">
            <span class="text-xl font-extrabold tracking-tighter text-netflix-red italic">BASEMENT<span class="text-white not-italic">TIME</span></span>
            <div id="status-container" class="hidden md:flex items-center bg-zinc-900/50 px-3 py-1 rounded-full border border-glass-border ml-4">
                <span id="player-status-text" class="text-xs font-medium truncate text-zinc-400 max-w-[300px]">Select content to stream</span>
            </div>
        </div>
        <a href="https://mysite2026.netlify.app/basement.html" class="text-[10px] font-bold uppercase tracking-widest text-zinc-500 hover:text-netflix-red transition-colors">Sports Hub</a>
    </header>

    <main id="main-content-area">

        <aside id="left-panel" class="w-[360px] bg-netflix-dark border-r border-glass-border flex flex-col shrink-0 transition-all duration-500 z-40">
            
            <div class="p-4 space-y-3">
                <button id="theater-toggle-top" onclick="toggleTheaterMode()" class="w-full flex items-center justify-center gap-2 py-2.5 bg-zinc-900 hover:bg-zinc-800 border border-glass-border rounded-xl text-xs font-bold transition-all group">
                    <i data-lucide="maximize-2" class="w-4 h-4 text-netflix-red group-hover:scale-110 transition-transform"></i>
                    ENTER THEATER MODE
                </button>

                <div class="grid grid-cols-2 gap-2">
                    <select id="genre-filter" class="bg-zinc-900 border border-glass-border text-[11px] p-2 rounded-lg text-white focus:outline-none"></select>
                    <select id="year-filter" class="bg-zinc-900 border border-glass-border text-[11px] p-2 rounded-lg text-white focus:outline-none">
                        <option value="">Year</option>
                    </select>
                </div>

                <div class="relative">
                    <i data-lucide="search" class="w-3.5 h-3.5 absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500"></i>
                    <input type="text" id="content-search" placeholder="Search library..." 
                           class="w-full bg-zinc-900 border border-glass-border rounded-lg py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-netflix-red outline-none">
                </div>
            </div>

            <div id="content-list-container" class="px-4 pb-4">
                <div id="content-list" class="space-y-2">
                    </div>
            </div>
        </aside>

        <section id="right-panel" class="flex-1 bg-[#050505] relative overflow-hidden flex flex-col transition-all duration-500">
            
            <div class="p-4 md:p-8 flex-1 flex flex-col justify-center items-center">
                <div id="player-area-wrapper" class="relative w-full max-w-5xl bg-black aspect-video rounded-2xl overflow-hidden shadow-2xl border border-glass-border transition-all duration-500">
                    
                    <div id="player-message-overlay" class="absolute inset-0 z-20 bg-netflix-dark flex flex-col items-center justify-center text-center p-6">
                        <i data-lucide="monitor-play" class="w-12 h-12 text-netflix-red mb-4 opacity-20"></i>
                        <h2 class="text-lg font-bold">Pick a title to start</h2>
                    </div>

                    <iframe id="stream-player-1" class="w-full h-full relative z-10" src="" frameborder="0" allowfullscreen sandbox="allow-same-origin allow-scripts"></iframe>

                    <div id="stream-controls-1" class="hidden absolute bottom-4 left-4 right-4 z-30 p-3 bg-black/80 backdrop-blur-md rounded-xl border border-glass-border flex items-center justify-between animate-in fade-in slide-in-from-bottom-2">
                        <div class="flex items-center gap-3">
                            <select id="source-selector-1" class="bg-netflix-red text-white text-[10px] font-black py-1 px-2 rounded-md outline-none"></select>
                            
                            <div id="tv-controls" class="hidden items-center gap-1 border-l border-zinc-700 ml-2 pl-3">
                                <button id="prev-episode-btn" class="p-1 hover:text-netflix-red transition-colors"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                                <select id="season-selector" class="bg-transparent text-[10px] font-bold w-12"></select>
                                <select id="episode-selector" class="bg-transparent text-[10px] font-bold w-12"></select>
                                <button id="next-episode-btn" class="p-1 hover:text-netflix-red transition-colors"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                            </div>
                        </div>

                        <button onclick="toggleTheaterMode()" class="text-[10px] font-bold px-3 py-1 rounded bg-white text-black hover:bg-zinc-200">
                            EXIT THEATER
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        // --- CORE LOGIC PRESERVED ---
        const TMDB_API_KEY = '1070730380f5fee0d87cf0382670b255';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        
        const availableSources = [
            { id: 'wplayme', name: 'Wplay.me', urls: { movie: 'https://embed.wplay.me/embed/movie/{id}', tv: 'https://embed.wplay.me/embed/tv/{id}/{season}/{episode}' } },
            { id: 'primewire', name: 'Primewire', urls: { movie: 'https://www.primewire.tf/embed/movie?tmdb={id}', tv: 'https://www.primewire.tf/embed/tv?tmdb={id}&season={season}&episode={episode}&server=fileLions' } },
            { id: 'rive', name: 'RiveStream', urls: { movie: 'https://rivestream.org/embed?type=movie&id={id}', tv: 'https://rivestream.org/embed?type=tv&id={id}&season={season}&episode={episode}' } },
            { id: 'vidsrcpk', name: 'VidSrcPk', urls: { movie: 'https://vidsrc.win/movie/?id={id}', tv: 'https://vidsrc.win/tv.html?id={id}&season={season}&episode={episode}' } },
            { id: 'vidnest', name: 'VidNest', urls: { movie: 'https://vidnest.fun/movie/{id}', tv: 'https://vidnest.fun/tv/{id}/{season}/{episode}' } }
        ];

        let selectedContent = null;
        let currentType = 'movie'; // Default

        const listEl = document.getElementById('content-list');
        const player = document.getElementById('stream-player-1');
        const overlay = document.getElementById('player-message-overlay');
        const controls = document.getElementById('stream-controls-1');
        const statusText = document.getElementById('player-status-text');

        async function safeFetch(url) {
            try { const res = await fetch(url); return await res.json(); } 
            catch { return null; }
        }

        async function fetchContent() {
            listEl.innerHTML = '<div class="p-10 text-center"><i data-lucide="loader" class="animate-spin text-netflix-red mx-auto"></i></div>';
            window.refreshIcons();

            const query = document.getElementById('content-search').value;
            const genre = document.getElementById('genre-filter').value;
            const year = document.getElementById('year-filter').value;
            
            // For simplicity in this layout, we auto-detect if user wants TV via search or default to Movies
            let url = `${TMDB_BASE_URL}/${query ? 'search' : 'discover'}/movie?api_key=${TMDB_API_KEY}&language=en-US&page=1`;
            
            if (query) url += `&query=${encodeURIComponent(query)}`;
            if (year) url += `&primary_release_year=${year}`;
            if (!query) url += '&sort_by=popularity.desc';

            const data = await safeFetch(url);
            listEl.innerHTML = '';
            data?.results?.forEach(item => {
                const div = document.createElement('div');
                div.className = 'glass-card p-2 rounded-xl cursor-pointer flex gap-3 items-center';
                const poster = item.poster_path ? IMAGE_BASE_URL + item.poster_path : 'https://placehold.co/100x150?text=No+Poster';
                
                div.innerHTML = `
                    <img src="${poster}" class="w-10 h-14 object-cover rounded shadow-md shrink-0">
                    <div class="min-w-0">
                        <h4 class="font-bold text-[11px] truncate">${item.title || item.name}</h4>
                        <div class="flex items-center gap-2 mt-0.5">
                            <span class="text-[9px] text-zinc-500">${(item.release_date || '').split('-')[0]}</span>
                            <span class="text-[9px] text-yellow-500 font-bold">â˜… ${item.vote_average?.toFixed(1)}</span>
                        </div>
                    </div>
                `;
                div.onclick = () => {
                    document.querySelectorAll('.glass-card').forEach(c => c.classList.remove('active'));
                    div.classList.add('active');
                    selectedContent = item;
                    loadStream();
                };
                listEl.appendChild(div);
            });
            window.refreshIcons();
        }

        function loadStream() {
            if (!selectedContent) return;
            overlay.classList.add('hidden');
            controls.classList.remove('hidden');
            controls.classList.add('flex');
            
            const srcId = document.getElementById('source-selector-1').value;
            const src = availableSources.find(s => s.id === srcId);
            const url = src.urls.movie.replace('{id}', selectedContent.id);
            
            player.src = url;
            statusText.textContent = `Streaming: ${selectedContent.title}`;
        }

        function toggleTheaterMode() {
            document.body.classList.toggle('theater-active');
            const btn = document.getElementById('theater-toggle-top');
            if (document.body.classList.contains('theater-active')) {
                btn.innerHTML = '<i data-lucide="minimize-2" class="w-4 h-4 text-netflix-red"></i> EXIT THEATER';
            } else {
                btn.innerHTML = '<i data-lucide="maximize-2" class="w-4 h-4 text-netflix-red"></i> ENTER THEATER';
            }
            window.refreshIcons();
        }

        window.onload = async () => {
            const srcSel = document.getElementById('source-selector-1');
            availableSources.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.id; opt.textContent = s.name;
                srcSel.appendChild(opt);
            });
            srcSel.onchange = loadStream;

            const curYear = new Date().getFullYear();
            for(let i=0; i<30; i++) {
                const opt = document.createElement('option');
                opt.value = curYear - i; opt.textContent = curYear - i;
                document.getElementById('year-filter').appendChild(opt);
            }

            const genres = await safeFetch(`${TMDB_BASE_URL}/genre/movie/list?api_key=${TMDB_API_KEY}`);
            const gSel = document.getElementById('genre-filter');
            gSel.innerHTML = '<option value="">All Genres</option>';
            genres?.genres?.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g.id; opt.textContent = g.name;
                gSel.appendChild(opt);
            });

            document.getElementById('content-search').oninput = () => {
                clearTimeout(window.searchTmt);
                window.searchTmt = setTimeout(fetchContent, 500);
            };
            gSel.onchange = fetchContent;
            document.getElementById('year-filter').onchange = fetchContent;

            fetchContent();
        };
    </script>
</body>
</html>
