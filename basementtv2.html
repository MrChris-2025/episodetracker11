<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basement Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'netflix-red': '#E50914',
                        'netflix-dark': '#0f0f0f',
                        'netflix-medium': '#1c1c1c',
                        'netflix-light': '#2c2c2c',
                    }
                }
            }
        }
    </script>
    <script type="module">
        import { createIcons, MonitorPlay, Film, Tv, ChevronLeft, ChevronRight, Search, Loader } from 'https://unpkg.com/lucide@latest';
        window.refreshIcons = () => createIcons({ icons: { MonitorPlay, Film, Tv, ChevronLeft, ChevronRight, Search, Loader } });
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f0f0f; color: #e4e4e7; margin: 0; overflow: hidden; }
        #main-content-area { height: calc(100vh - 4rem); display: flex; }
        #content-list-container { overflow-y: auto; height: 100%; flex-grow: 1; scroll-behavior: smooth; }
        #content-list-container::-webkit-scrollbar { width: 6px; }
        #content-list-container::-webkit-scrollbar-thumb { background-color: #e50914; border-radius: 3px; }
        .player-iframe { height: 450px; max-width: 100%; transition: all 0.5s ease; }
        .theater-iframe-stretch { height: 80vh !important; }
        .full-immersion-right { padding: 0 !important; }
        .overlay-controls { 
            position: absolute; bottom: 2rem; left: 2rem; right: 2rem; z-index: 50;
            background: rgba(15, 15, 15, 0.95); padding: 1rem; border-radius: 1rem;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .overlay-visible { opacity: 1; pointer-events: auto; }
        @media (max-width: 768px) {
            #main-content-area { flex-direction: column; overflow-y: auto; }
            #left-panel { width: 100% !important; min-width: 100% !important; height: auto; }
            .player-iframe { height: 250px; }
        }
    </style>
</head>
<body>

    <header class="h-16 bg-netflix-medium flex items-center px-6 shadow-xl z-10 border-b border-red-800">
        <h1 class="text-2xl font-bold text-netflix-red">Basement Time</h1>
        <div class="flex-grow flex justify-center">
            <span id="player-status-text" class="text-lg font-bold text-white truncate px-4">Select Content to Start</span>
        </div>
    </header>

    <div id="main-content-area">
        <div id="left-panel" class="w-[30%] min-w-[350px] bg-netflix-medium p-4 flex flex-col space-y-4 border-r border-gray-800 transition-all duration-500">
            <div class="space-y-3">
                <div class="flex bg-netflix-dark rounded-xl p-1 border border-red-900">
                    <button onclick="handleContentToggle('movie')" id="btn-movie" class="flex-grow py-2 rounded-lg bg-netflix-red text-white text-sm font-bold">Movies</button>
                    <button onclick="handleContentToggle('tv')" id="btn-tv" class="flex-grow py-2 rounded-lg text-gray-400 text-sm font-bold">TV Shows</button>
                </div>
                <div class="flex space-x-2">
                    <select id="genre-filter" onchange="fetchContent()" class="w-1/2 p-2 bg-netflix-dark border border-gray-700 rounded text-sm text-white"></select>
                    <select id="year-filter" onchange="fetchContent()" class="w-1/2 p-2 bg-netflix-dark border border-gray-700 rounded text-sm text-white"></select>
                </div>
                <input type="text" id="content-search" oninput="fetchContent()" placeholder="Search..." class="w-full p-2 bg-netflix-dark border border-gray-700 rounded text-white">
            </div>

            <div id="content-list-container">
                <div id="content-list" class="space-y-3"></div>
            </div>
        </div>

        <div id="right-panel" class="flex-grow bg-netflix-dark p-6 flex flex-col relative transition-all duration-500">
            <div id="player-area-1" class="relative bg-black rounded-xl overflow-hidden flex-grow flex items-center justify-center">
                <div id="player-message-overlay" class="absolute inset-0 z-10 bg-netflix-dark flex flex-col items-center justify-center text-center p-6">
                    <div class="text-netflix-red mb-4"><i data-lucide="monitor-play" class="w-16 h-16"></i></div>
                    <h2 class="text-2xl font-bold">Ready to Stream</h2>
                    <p class="text-gray-500">Select a title from the list to begin.</p>
                </div>
                <iframe id="stream-player-1" class="player-iframe w-full h-full" allowfullscreen frameborder="0"></iframe>
            </div>

            <div id="stream-controls-1" class="mt-4 flex flex-wrap items-center justify-between bg-netflix-medium p-4 rounded-lg border border-red-900 gap-4">
                <select id="source-selector-1" class="p-2 bg-red-800 rounded text-white text-sm"></select>
                
                <div id="tv-controls" class="hidden flex items-center space-x-2">
                    <button onclick="handleEpisodeNavigation('prev')" class="p-2 bg-gray-700 rounded"><i data-lucide="chevron-left" class="w-4 h-4"></i></button>
                    <select id="season-selector" class="p-2 bg-netflix-dark rounded text-xs"></select>
                    <select id="episode-selector" class="p-2 bg-netflix-dark rounded text-xs"></select>
                    <button onclick="handleEpisodeNavigation('next')" class="p-2 bg-gray-700 rounded"><i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                </div>

                <button onclick="toggleTheaterMode()" id="theater-btn" class="px-4 py-2 bg-red-700 hover:bg-red-600 rounded font-bold text-sm">Theater Mode</button>
            </div>
        </div>
    </div>

    <script>
        const TMDB_API_KEY = '1070730380f5fee0d87cf0382670b255';
        const sources = [
            { id: 'wplayme', name: 'Wplay', urls: { movie: 'https://embed.wplay.me/embed/movie/{id}', tv: 'https://embed.wplay.me/embed/tv/{id}/{season}/{episode}' } },
            { id: 'rive', name: 'RiveStream', urls: { movie: 'https://rivestream.org/embed?type=movie&id={id}', tv: 'https://rivestream.org/embed?type=tv&id={id}&season={season}&episode={episode}' } },
            { id: 'vidsrcpk', name: 'VidSrc', urls: { movie: 'https://vidsrc.win/movie/?id={id}', tv: 'https://vidsrc.win/tv.html?id={id}&season={season}&episode={episode}' } }
        ];

        let currentType = 'movie';
        let selectedContent = null;
        let tvData = null;
        let isTheater = false;

        async function fetchContent() {
            const query = document.getElementById('content-search').value;
            const genre = document.getElementById('genre-filter').value;
            const year = document.getElementById('year-filter').value;
            
            let url = `https://api.themoviedb.org/3/${query ? 'search' : 'discover'}/${currentType}?api_key=${TMDB_API_KEY}&language=en-US&page=1`;
            if (query) url += `&query=${encodeURIComponent(query)}`;
            if (genre) url += `&with_genres=${genre}`;
            if (year) url += `&${currentType === 'movie' ? 'primary_release_year' : 'first_air_date_year'}=${year}`;

            const res = await fetch(url);
            const data = await res.json();
            renderList(data.results || []);
        }

        function renderList(items) {
            const container = document.getElementById('content-list');
            container.innerHTML = items.map(item => `
                <div onclick='selectItem(${JSON.stringify(item).replace(/'/g, "&apos;")})' class="flex p-3 bg-netflix-dark border border-gray-800 rounded-lg cursor-pointer hover:border-red-600 transition">
                    <img src="https://image.tmdb.org/t/p/w92${item.poster_path}" class="w-12 h-18 rounded shadow">
                    <div class="ml-3 overflow-hidden">
                        <div class="font-bold text-sm truncate">${item.title || item.name}</div>
                        <div class="text-xs text-gray-500">${(item.release_date || item.first_air_date || '').split('-')[0]} • ★${item.vote_average}</div>
                    </div>
                </div>
            `).join('');
            if (window.refreshIcons) window.refreshIcons();
        }

        async function selectItem(item) {
            selectedContent = item;
            document.getElementById('player-message-overlay').classList.add('hidden');
            document.getElementById('player-status-text').textContent = item.title || item.name;
            
            if (currentType === 'tv') {
                const res = await fetch(`https://api.themoviedb.org/3/tv/${item.id}?api_key=${TMDB_API_KEY}`);
                tvData = await res.json();
                setupTVSelectors();
                document.getElementById('tv-controls').classList.remove('hidden');
            } else {
                document.getElementById('tv-controls').classList.add('hidden');
            }
            updatePlayer();
        }

        function setupTVSelectors() {
            const sSel = document.getElementById('season-selector');
            sSel.innerHTML = tvData.seasons.filter(s => s.season_number > 0).map(s => `<option value="${s.season_number}">S${s.season_number}</option>`).join('');
            sSel.onchange = updateEpisodes;
            updateEpisodes();
        }

        function updateEpisodes() {
            const seasonNum = document.getElementById('season-selector').value;
            const season = tvData.seasons.find(s => s.season_number == seasonNum);
            const eSel = document.getElementById('episode-selector');
            eSel.innerHTML = Array.from({length: season.episode_count}, (_, i) => `<option value="${i+1}">Ep ${i+1}</option>`).join('');
            eSel.onchange = updatePlayer;
            updatePlayer();
        }

        function updatePlayer() {
            const sourceId = document.getElementById('source-selector-1').value;
            const source = sources.find(s => s.id === sourceId);
            const season = document.getElementById('season-selector').value || 1;
            const episode = document.getElementById('episode-selector').value || 1;
            
            let url = currentType === 'movie' ? source.urls.movie : source.urls.tv;
            url = url.replace('{id}', selectedContent.id).replace('{season}', season).replace('{episode}', episode);
            document.getElementById('stream-player-1').src = url;
        }

        function handleContentToggle(type) {
            currentType = type;
            document.getElementById('btn-movie').className = type === 'movie' ? 'flex-grow py-2 rounded-lg bg-netflix-red text-white text-sm font-bold' : 'flex-grow py-2 rounded-lg text-gray-400 text-sm font-bold';
            document.getElementById('btn-tv').className = type === 'tv' ? 'flex-grow py-2 rounded-lg bg-netflix-red text-white text-sm font-bold' : 'flex-grow py-2 rounded-lg text-gray-400 text-sm font-bold';
            fetchContent();
        }

        function toggleTheaterMode() {
            isTheater = !isTheater;
            const left = document.getElementById('left-panel');
            const right = document.getElementById('right-panel');
            const controls = document.getElementById('stream-controls-1');
            
            if (isTheater) {
                left.style.width = '0'; left.style.minWidth = '0'; left.style.opacity = '0';
                right.classList.add('full-immersion-right');
                controls.classList.add('overlay-controls');
                document.getElementById('theater-btn').textContent = "Exit Theater";
                right.onmousemove = () => { controls.classList.add('overlay-visible'); clearTimeout(window.tTimer); window.tTimer = setTimeout(()=>controls.classList.remove('overlay-visible'), 3000); };
            } else {
                left.style.width = '30%'; left.style.minWidth = '350px'; left.style.opacity = '1';
                right.classList.remove('full-immersion-right');
                controls.classList.remove('overlay-controls', 'overlay-visible');
                document.getElementById('theater-btn').textContent = "Theater Mode";
                right.onmousemove = null;
            }
        }

        window.onload = () => {
            const srcSel = document.getElementById('source-selector-1');
            srcSel.innerHTML = sources.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
            srcSel.onchange = updatePlayer;
            
            const yearSel = document.getElementById('year-filter');
            yearSel.innerHTML = '<option value="">Year</option>' + Array.from({length: 30}, (_, i) => `<option value="${2026-i}">${2026-i}</option>`).join('');
            
            fetchContent();
            setTimeout(() => window.refreshIcons(), 500);
        };
    </script>
</body>
</html>
